# 02 | 事件循环：Flutter 中代码是如何执行和运行的

https://github.com/qing-song/Flutter/blob/master/images/flutter_02_event.png

## Dart 单线程

单线程在流畅性方面有一定安全保障，这点在 JavaScript 中存在类似的机制原理，其核心是分为主线程、微任务和宏任务。主线程执行主业务逻辑，网络 I/O 、本地文件 I/O 、异步事件等相关任务事件，应用事件驱动方式来执行。在 Dart 中同样是单线程执行，其次也包含了两个事件队列，一个是微任务事件队列，一个是事件队列。

- 微任务队列

微任务队列包含有 Dart 内部的微任务，主要是通过 scheduleMicrotask 来调度。

- 事件队列

事件队列包含外部事件，例如 I/O 、 Timer ，绘制事件等等

## 事件循环

### 疑问1，为什么事件任务都执行完成了，还需要继续再循环判断是否有微任务？

核心解释是：微任务在执行过程中，也会产生新的事件任务，事件任务在执行过程中也会产生新的微任务。产生的新微任务，按照执行流程，需要根据队列方式插入到任务队列最后。

### 疑问2，Dart 运行过程中是否会被事件运行卡住？

答案是会，比如在运行某个微任务，该微任务非常的耗时，会导致其他微任务和事件任务卡住，从而影响到一些实际运行

## Isolate 多线程

Dart 的单线程叫作 isolate 线程，**每个 isolate 线程之间是不共享内存的，通过消息机制通信**。
